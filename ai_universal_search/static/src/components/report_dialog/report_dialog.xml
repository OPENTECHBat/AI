<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="ai_universal_search.report_dialog" owl="1">
        <Dialog size="'lg'" title="'Create Report'" technical="false">
            <div class="p-3">
                <!-- Validation error alert -->
                <div t-if="state.validationError" class="alert alert-danger mb-3" role="alert">
                    <i class="fa fa-exclamation-triangle me-2"></i>
                    <span t-esc="state.validationError"/>
                </div>
                
                <div class="form-group mb-3">
                    <label for="report_name" class="form-label">Report Name</label>
                    <input type="text" class="form-control" id="report_name" t-model="state.name"/>
                </div>
                
                <div class="form-group mb-3">
                    <label for="visualization_type" class="form-label">Visualization Type</label>
                    <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="visualization_type" id="type_bar" value="bar"
                               t-model="state.visualizationType" t-on-change="onVisualizationTypeChanged" autocomplete="off"
                               checked="checked" />
                        <label class="btn btn-outline-primary" for="type_bar">
                            <i class="fa fa-bar-chart me-1"></i> Bar Chart
                        </label>
                        
                        <input type="radio" class="btn-check" name="visualization_type" id="type_line" value="line"
                               t-model="state.visualizationType" t-on-change="onVisualizationTypeChanged" autocomplete="off" />
                        <label class="btn btn-outline-primary" for="type_line">
                            <i class="fa fa-line-chart me-1"></i> Line Chart
                        </label>
                        
                        <input type="radio" class="btn-check" name="visualization_type" id="type_pie" value="pie"
                               t-model="state.visualizationType" t-on-change="onVisualizationTypeChanged" autocomplete="off" />
                        <label class="btn btn-outline-primary" for="type_pie">
                            <i class="fa fa-pie-chart me-1"></i> Pie Chart
                        </label>
                    </div>
                </div>
                
                <!-- Visualization type specific configuration options -->
                <!-- Field selection area - common for all visualizations -->
                <h5 class="mt-3 mb-3">Data Field Selection</h5>

                <div class="mb-3">
                    <label for="dimension_field" class="form-label">Dimension Field (X-axis)</label>
                    <select id="dimension_field" class="form-select" t-on-change="onDimensionFieldChanged">
                        <t t-foreach="state.availableFields" t-as="field" t-key="field.name">
                            <option t-att-value="field.name" t-att-selected="state.dimensionField === field.name">
                                <t t-esc="field.label"/>
                                <t t-if="field.type === 'date'">(Date)</t>
                                <t t-elif="field.type === 'number'">(Number)</t>
                            </option>
                        </t>
                    </select>
                    <small class="form-text text-muted">Field to use for categories/labels</small>
                </div>

                <div class="mb-3">
                    <label for="measure_field" class="form-label">Measure Field (Y-axis)</label>
                    <select id="measure_field" class="form-select" t-on-change="onMeasureFieldChanged">
                        <t t-foreach="state.availableFields" t-as="field" t-key="field.name">
                            <option t-att-value="field.name" t-att-selected="state.measureField === field.name">
                                <t t-esc="field.label"/>
                                <t t-if="field.type === 'number'">(Number)</t>
                            </option>
                        </t>
                    </select>
                    <small class="form-text text-muted">Field to use for values</small>
                </div>

                <div class="mb-3">
                    <label for="aggregation_type" class="form-label">Aggregation Type</label>
                    <select id="aggregation_type" class="form-select" t-on-change="onAggregationTypeChanged">
                        <t t-foreach="_getApplicableAggregationTypes()" t-as="aggType" t-key="aggType.id">
                            <option t-att-value="aggType.id" t-att-selected="state.aggregationType === aggType.id">
                                <t t-esc="aggType.name"/>
                            </option>
                        </t>
                    </select>
                    <small class="form-text text-muted">How to aggregate the measure field values</small>
                </div>

                <!-- Visualization type specific configurations -->
                <h5 class="mt-4 mb-3">Chart Options</h5>

                <div t-if="state.visualizationType === 'bar'" class="visualization-config">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="stacked_option" 
                              t-model="state.config.stacked" />
                        <label class="form-check-label" for="stacked_option">
                            Stacked Bar Chart
                        </label>
                    </div>

                    <!-- Series field for stacked bar chart -->
                    <div t-if="state.config.stacked" class="mb-3">
                        <label for="series_field" class="form-label">Series Field (Stacking Groups)</label>
                        <select id="series_field" class="form-select" t-on-change="onSeriesFieldChanged">
                            <t t-foreach="state.availableFields" t-as="field" t-key="field.name">
                                <option t-att-value="field.name" t-att-selected="state.seriesField === field.name">
                                    <t t-esc="field.label"/>
                                </option>
                            </t>
                        </select>
                        <small class="form-text text-muted">Field to use for grouping data into stacked segments</small>
                    </div>
                </div>
                
                <div t-if="state.visualizationType === 'line'" class="visualization-config">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="cumulated_option" 
                              t-model="state.config.cumulated" />
                        <label class="form-check-label" for="cumulated_option">
                            Cumulative Values
                        </label>
                    </div>
                    
                    <!-- Help text for cumulative charts -->
                    <div t-if="state.config.cumulated" class="alert alert-info">
                        <i class="fa fa-info-circle me-2"></i>
                        For cumulative charts, it's recommended to use a date field as the dimension (X-axis) 
                        to ensure values are properly accumulated over time.
                    </div>
                </div>
                
                <div t-if="state.visualizationType === 'pie'" class="visualization-config">
                    <!-- Pie chart specific options can be added here in the future -->
                    <div class="alert alert-info">
                        <i class="fa fa-info-circle me-2"></i>
                        Pie charts are best used for showing composition or proportions.
                    </div>
                </div>
            </div>
            
            <t t-set-slot="footer">
                <button class="btn btn-secondary" t-on-click="onCancel">Cancel</button>
                <button class="btn btn-primary ms-2" t-on-click="onConfirm">Create Report</button>
            </t>
        </Dialog>
    </t>
</templates>
